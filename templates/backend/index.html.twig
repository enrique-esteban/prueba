{% extends 'base.html.twig' %}

{% block title %}
    Gestor de tareas
{% endblock %}

{% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('#addJob').click(function () {
                var name = $('#name').val();
                var categories = "";
                var categoriesArray = $(".category");

                if (name === "") {
                    alert("campo vacio");
                } else {
                    categoriesArray.each(function () {
                        var item = $(this);
                        item.is(':checked') ? categories += (item.attr("name") + ",") : "";
                    });
                    categories = categories.slice(0, -1);

                    var job = {
                        name: name,
                        categories: categories
                    };

                    $.ajax({
                        url: "{{ url('ajax_save_job') }}",
                        type: "POST",
                        dataType: "json",
                        data: {
                            "job": job
                        },
                        async: true,
                        success: function (data) {
                            console.log(data)
                        }
                    });
                }

            });


            console.log('ready');
        })
    </script>
{% endblock %}
{% block body %}
    {% if job is defined %}
        job
    {% endif %}
    <div class="example-wrapper">
        <h1>Gestor de taréas</h1>
        <hr>
        <form id="addjob" method="post" accept-charset="UTF-8">
            <input type="hidden" name="action" value="users/send-password-reset-email">

            <input id="name" type="text" name="name" value="Nueva tarea" class="form-control"/>
            <br>

            <input name="php" type="checkbox" class="category form-check-input">
            <label for="php" class="form-check-label">PHP</label>

            <input name="javascript" type="checkbox" class="category form-check-input">
            <label for="javascript" class="form-check-label">JavaScript</label>

            <input tname="css" type="checkbox" class="category form-check-input">
            <label for="css" class="form-check-label">CSS</label>

            {% if errors is defined %}
                <ul class="errors">
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <input id="addJob" type="submit" value="Añadir" class="btn btn-primary"/>
        </form>
    </div>
    <br><br>

    <div class="row mb-3">
        <div class="col-md-8 themed-grid-col">
            <table id="jobList" class="table">
                <thead>
                    <tr>
                        <th scope="col">Tareas</th>
                        <th scope="col">Categorías</th>
                        <th scope="col">Acciones</th>
                    </tr>
                </thead>
                <tbody></tbody>

                {% for job in jobs %}
                    <tr>
                        <th>{{ job.name }}</th>
                        <th>{{ job.categories }}</th>
                        <th>X</th>
                    </tr>
                {% endfor %}
            </table>
        </div>
        {% for job in jobs %}
            {{ dump(job.name) }}
        {% endfor %}
        {{ dump(jobs) }}
    </div>
{% endblock %}
